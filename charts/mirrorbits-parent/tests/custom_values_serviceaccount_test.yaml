suite: Tests with custom values
set:
  ## Mock subcharts default values
  mirrorbits-lite:
    enabled: true
    backendServiceNameTpl: '{{ default "RELEASE-NAME-mirrorbits-lite" }}'
    service:
      port: 7777
  httpd:
    enabled: true
    backendServiceNameTpl: '{{ default "RELEASE-NAME-httpd" }}'
    service:
      port: 8080
  ## End of subchart mocked values
  serviceaccount:
    enabled: true
templates:
  - serviceaccount.yaml
tests:
  - it: should create a new service account
    template: serviceaccount.yaml
    asserts:
      - hasDocuments:
          count: 4
      - isKind:
          of: ServiceAccount
        documentIndex: 0
  - it: should use an existing service account
    template: serviceaccount.yaml
    set:
      serviceaccount:
        existingServiceAccount: 'existingSA'
    asserts:
      - hasDocuments:
          count: 2
      - isKind:
          of: Role
        documentIndex: 0
      - isKind:
          of: RoleBinding
        documentIndex: 1
